<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: index.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: index.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/*
 * index.js is the entry point of the website. It initilizes the database, dashboard, sidebar, and note editor.
 *
 * Functions inside this file:
 *   - switchToDashboard()
 *   - switchToEditor()
 *   - URLRoutingHandler()
 *   - initEventHandler()
 *   - init()
 */
import { pageData, updateURL } from './Routing.js';
import { initializeDB, getNotesFromStorage, getNoteFromStorage } from './noteStorage.js';
import { addNoteToDocument, initEditor } from './notesEditor.js';
import { initializeTagDB, getTagsFromStorage, addTagsToDOM } from './tagStorage.js';
import { addTagsToSidebar } from './sidebar.js';
import { getDate } from './utility.js';
import { addNotesToDocument, initSearchBar, initSortBy } from './notesDashboard.js';
import { initSettings } from './settings.js';

/**
 * @description Switches current view to dashboard
 *
 * @param {HTMLElement} dom - Object containing DOM elements to hide/unhide dashboard and editor
 * @returns {void} this function does not return a value.
 */
async function switchToDashboard(dom) {
  const db = pageData.database;
  pageData.tags = await getTagsFromStorage(pageData.tagDB); // Fetch tags from storage and update pageData tags
  addTagsToSidebar();
  // Fetch notes from storage using the database object
  const notes = await getNotesFromStorage(db);
  const noteTagsElement = document.getElementById('notes-tags');
  noteTagsElement.innerHTML = ''; // Clear existing tags

  // Reset the tag-input value to its default
  document.getElementById('tag-input').value = document.getElementById('tag-input').defaultValue;
  addNotesToDocument(notes);

  // Toggle visibility of editor and dashboard
  dom.editor.classList.add('hidden');
  dom.dashboard.classList.remove('hidden');
  pageData.page = 'dashboard';
}

/**
 * @description Switches current view to editor
 *
 * @param {Number} id note id
 * @param {HTMLElement} dom to hide/unhide dashboard and editor
 * @returns {void} This function does not return a value.
 */
async function switchToEditor(id, dom) {
  if (id !== 9999) {
    // Not a new note
    const db = pageData.database;
    const note = await getNoteFromStorage(db, id);
    pageData.editEnabled = false;
    const tagsObjectStore = await pageData.tagDB.transaction('tags').objectStore('tags');
    await addTagsToDOM(tagsObjectStore, note);
    addNoteToDocument(note); // Populated Note editor page
  } else {
    // New note
    const noteObject = {
      title: '',
      lastModified: `${getDate()}`,
      tags: [],
      content: '',
    };
    const tagsObjectStore = await pageData.tagDB.transaction('tags').objectStore('tags');
    await addTagsToDOM(tagsObjectStore, noteObject);
    await addNoteToDocument(noteObject);
  }

  // Toggle visibility of editor and dashboard
  dom.editor.classList.remove('hidden');
  dom.dashboard.classList.add('hidden');
  pageData.page = 'editor';
}

/**
 * @description handles url routing, checks url parameters and loads
 *              dashboard or editor accordingly
 *
 * @returns {void} This function does not return a value.
 */
function URLRoutingHandler() {
  const urlParams = new URLSearchParams(window.location.search);
  const id = urlParams.get('id');

  if (id === '9999' || id == null) {
    pageData.noteID = null;
  } else {
    pageData.noteID = parseInt(id, 10);
  }

  // So that child functions can hide/unhide dashboard or editor
  const dom = {
    editor: document.querySelector('.editor'),
    dashboard: document.querySelector('.dashboard'),
  };

  if (id == null) {
    switchToDashboard(dom);
  } else {
    switchToEditor(parseInt(id, 10), dom);
  }
}

/**
 * @description Initializes the theme toggle functionality, allowing users to switch between light and dark modes.
 *
 * @returns {void} This function does not return a value.
 */
function initThemeToggle() {
  const darkModeButton = document.querySelector('#darkMode');
  darkModeButton.addEventListener('click', () => {
    darkModeButton.textContent = document.body.classList.contains('dark') ? 'Light' : 'Dark';
    pageData.theme = pageData.theme === 'light' ? 'dark' : 'light';
    document.documentElement.setAttribute('data-theme', pageData.theme);
  });
}

/**
 * @description Initializes the necessary components for Sidebar and Notes
 *              dashboard
 *
 * @returns {void} This function does not return a value.
 */
async function initEventHandler() {
  const db = pageData.database;
  const notes = await getNotesFromStorage(db);
  initSearchBar(notes);
  initThemeToggle();
  initSortBy();

  // Clicking on logo redirects to dashboard
  document.querySelector('.header > h1').addEventListener('click', async () => updateURL(''));

  // works with URLRoutingHandler to give SPA functionality
  let currURL = window.location.search;
  window.addEventListener('popstate', () => {
    const newURL = window.location.search;
    if (newURL !== currURL) {
      currURL = newURL;
      URLRoutingHandler();
    }
  });
}

/**
 * @description Main INIT function. Is called when dom is loaded.
 *              Initializes:
 *                Sidebar
 *                Notes Dashboard
 *                Note Editor
 *                Database ( connects if one is existing )
 
 * @returns {void} This function does not return a value.
 */
async function init() {
  document.querySelector('#newNote').addEventListener('click', () => updateURL('?id=9999'));
  pageData.database = await initializeDB(indexedDB);
  pageData.tagDB = await initializeTagDB(indexedDB);
  initEventHandler();
  initSettings();
  initEditor();
  URLRoutingHandler();
}

window.addEventListener('DOMContentLoaded', init);
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Classes</h3><ul><li><a href="dashboardRow.html">dashboardRow</a></li></ul><h3>Global</h3><ul><li><a href="global.html#URLRoutingHandler">URLRoutingHandler</a></li><li><a href="global.html#addNoteToDocument">addNoteToDocument</a></li><li><a href="global.html#addNotesToDocument">addNotesToDocument</a></li><li><a href="global.html#addTags">addTags</a></li><li><a href="global.html#addTagsToDOM">addTagsToDOM</a></li><li><a href="global.html#addTagsToDocument">addTagsToDocument</a></li><li><a href="global.html#addTagsToSidebar">addTagsToSidebar</a></li><li><a href="global.html#alertDialog">alertDialog</a></li><li><a href="global.html#confirmDialog">confirmDialog</a></li><li><a href="global.html#copyNote">copyNote</a></li><li><a href="global.html#createNoteObject">createNoteObject</a></li><li><a href="global.html#createTagHTML">createTagHTML</a></li><li><a href="global.html#deleteNote">deleteNote</a></li><li><a href="global.html#deleteNoteFromStorage">deleteNoteFromStorage</a></li><li><a href="global.html#deleteTagFromStorage">deleteTagFromStorage</a></li><li><a href="global.html#dom">dom</a></li><li><a href="global.html#exportNote">exportNote</a></li><li><a href="global.html#filterNotesByQuery">filterNotesByQuery</a></li><li><a href="global.html#filterNotesByTags">filterNotesByTags</a></li><li><a href="global.html#generateRandomString">generateRandomString</a></li><li><a href="global.html#getAllTagsFromStorage">getAllTagsFromStorage</a></li><li><a href="global.html#getDate">getDate</a></li><li><a href="global.html#getNoteFromStorage">getNoteFromStorage</a></li><li><a href="global.html#getNotesFromStorage">getNotesFromStorage</a></li><li><a href="global.html#getSelectedTags">getSelectedTags</a></li><li><a href="global.html#getTagFromStorage">getTagFromStorage</a></li><li><a href="global.html#getTagNumNotes">getTagNumNotes</a></li><li><a href="global.html#getTagsFromStorage">getTagsFromStorage</a></li><li><a href="global.html#hideEmptyWojak">hideEmptyWojak</a></li><li><a href="global.html#importNote">importNote</a></li><li><a href="global.html#init">init</a></li><li><a href="global.html#initDialog">initDialog</a></li><li><a href="global.html#initEditor">initEditor</a></li><li><a href="global.html#initEventHandler">initEventHandler</a></li><li><a href="global.html#initSearchBar">initSearchBar</a></li><li><a href="global.html#initSettings">initSettings</a></li><li><a href="global.html#initSortBy">initSortBy</a></li><li><a href="global.html#initThemeToggle">initThemeToggle</a></li><li><a href="global.html#initializeDB">initializeDB</a></li><li><a href="global.html#initializeTagDB">initializeTagDB</a></li><li><a href="global.html#parseNoteDate">parseNoteDate</a></li><li><a href="global.html#saveNote">saveNote</a></li><li><a href="global.html#saveNoteToStorage">saveNoteToStorage</a></li><li><a href="global.html#saveTagToStorage">saveTagToStorage</a></li><li><a href="global.html#searchByTag">searchByTag</a></li><li><a href="global.html#sortNotesByTime">sortNotesByTime</a></li><li><a href="global.html#sortNotesByTitle">sortNotesByTitle</a></li><li><a href="global.html#switchToDashboard">switchToDashboard</a></li><li><a href="global.html#switchToEditor">switchToEditor</a></li><li><a href="global.html#toggleClassToArr">toggleClassToArr</a></li><li><a href="global.html#updateTagNumNotes">updateTagNumNotes</a></li><li><a href="global.html#updateURL">updateURL</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 4.0.3</a> on Sun Jun 09 2024 17:36:15 GMT-0700 (Pacific Daylight Time)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
